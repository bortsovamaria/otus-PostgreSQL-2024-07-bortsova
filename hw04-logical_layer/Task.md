# Домашнее задание
Установка и настройка PostgteSQL в контейнере Docker

## Цель:
* установить PostgreSQL в Docker контейнере
* настроить контейнер для внешнего подключения

### Описание/Пошаговая инструкция выполнения домашнего задания:
1) создать ВМ с Ubuntu 20.04/22.04 или развернуть докер любым удобным способом
2) поставить на нем Docker Engine
3) сделать каталог /var/lib/postgres
4) развернуть контейнер с PostgreSQL 15 смонтировав в него /var/lib/postgresql
5) развернуть контейнер с клиентом postgres
6) подключится из контейнера с клиентом к контейнеру с сервером и сделать таблицу с парой строк
7) подключится к контейнеру с сервером с ноутбука/компьютера извне инстансов ЯО/места установки докера
8) удалить контейнер с сервером
9) создать его заново
10) подключится снова из контейнера с клиентом к контейнеру с сервером
11) проверить, что данные остались на месте
12) оставляйте в ЛК ДЗ комментарии что и как вы делали и как боролись с проблемами


# Домашнее задание
Установка и настройка PostgreSQL

## Цель:
1) создавать дополнительный диск для уже существующей виртуальной машины, размечать его и делать на нем файловую систему
2) переносить содержимое базы данных PostgreSQL на дополнительный диск
3) переносить содержимое БД PostgreSQL между виртуальными машинами

### Описание/Пошаговая инструкция выполнения домашнего задания:
1) создайте виртуальную машину c Ubuntu 20.04/22.04 LTS в ЯО/Virtual Box/докере
2) поставьте на нее PostgreSQL 15 через sudo apt
3) проверьте что кластер запущен через sudo -u postgres pg_lsclusters
4) зайдите из под пользователя postgres в psql и сделайте произвольную таблицу с произвольным содержимым
5) postgres=# create table test(c1 text);
6) postgres=# insert into test values('1');
7) \q
8) остановите postgres например через sudo -u postgres pg_ctlcluster 15 main stop
9) создайте новый диск к ВМ размером 10GB
10) добавьте свеже-созданный диск к виртуальной машине - надо зайти в режим ее редактирования и дальше выбрать пункт attach existing disk
11) проинициализируйте диск согласно инструкции и подмонтировать файловую систему, только не забывайте менять имя диска на актуальное, в вашем случае это скорее всего будет /dev/sdb - https://www.digitalocean.com/community/tutorials/how-to-partition-and-format-storage-devices-in-linux
12) перезагрузите инстанс и убедитесь, что диск остается примонтированным (если не так смотрим в сторону fstab)
13) сделайте пользователя postgres владельцем /mnt/data - chown -R postgres:postgres /mnt/data/
14) перенесите содержимое /var/lib/postgres/15 в /mnt/data - mv /var/lib/postgresql/15/mnt/data
15) попытайтесь запустить кластер - sudo -u postgres pg_ctlcluster 15 main start
16) напишите получилось или нет и почему
17) задание: найти конфигурационный параметр в файлах раположенных в /etc/postgresql/15/main который надо поменять и поменяйте его
18) напишите что и почему поменяли
19) попытайтесь запустить кластер - sudo -u postgres pg_ctlcluster 15 main start
20) напишите получилось или нет и почему
21) зайдите через через psql и проверьте содержимое ранее созданной таблицы
22) задание со звездочкой *: не удаляя существующий инстанс ВМ сделайте новый, поставьте на его PostgreSQL, удалите файлы с данными из /var/lib/postgres, перемонтируйте внешний диск который сделали ранее от первой виртуальной машины ко второй и запустите PostgreSQL на второй машине так чтобы он работал с данными на внешнем диске, расскажите как вы это сделали и что в итоге получилось.

# Домашнее задание
Работа с базами данных, пользователями и правами

## Цель:
* создание новой базы данных, схемы и таблицы
* создание роли для чтения данных из созданной схемы созданной базы данных
* создание роли для чтения и записи из созданной схемы созданной базы данных

### Описание/Пошаговая инструкция выполнения домашнего задания:
1) создайте новый кластер PostgresSQL 14
2) зайдите в созданный кластер под пользователем postgres
3) создайте новую базу данных testdb
4) зайдите в созданную базу данных под пользователем postgres
5) создайте новую схему testnm
6) создайте новую таблицу t1 с одной колонкой c1 типа integer
7) вставьте строку со значением c1=1
8) создайте новую роль readonly
9) дайте новой роли право на подключение к базе данных testdb
10) дайте новой роли право на использование схемы testnm
11) дайте новой роли право на select для всех таблиц схемы testnm
12) создайте пользователя testread с паролем test123
13) дайте роль readonly пользователю testread
14) зайдите под пользователем testread в базу данных testdb
15) сделайте select * from t1;
16) получилось? (могло если вы делали сами не по шпаргалке и не упустили один существенный момент про который позже)
17) напишите что именно произошло в тексте домашнего задания
18) у вас есть идеи почему? ведь права то дали?
19) посмотрите на список таблиц
20) подсказка в шпаргалке под пунктом 20
21) а почему так получилось с таблицей (если делали сами и без шпаргалки то может у вас все нормально)
22) вернитесь в базу данных testdb под пользователем postgres
23) удалите таблицу t1
24) создайте ее заново но уже с явным указанием имени схемы testnm
25) вставьте строку со значением c1=1
26) зайдите под пользователем testread в базу данных testdb
27) сделайте select * from testnm.t1;
28) получилось?
29) есть идеи почему? если нет - смотрите шпаргалку
30) как сделать так чтобы такое больше не повторялось? если нет идей - смотрите шпаргалку
31) сделайте select * from testnm.t1;
32) получилось?
33) есть идеи почему? если нет - смотрите шпаргалку
34) сделайте select * from testnm.t1;
35) получилось?
36) ура!
37) теперь попробуйте выполнить команду create table t2(c1 integer); insert into t2 values (2);
38) а как так? нам же никто прав на создание таблиц и insert в них под ролью readonly?
39) есть идеи как убрать эти права? если нет - смотрите шпаргалку
40) если вы справились сами то расскажите что сделали и почему, если смотрели шпаргалку - объясните что сделали и почему выполнив указанные в ней команды
41) теперь попробуйте выполнить команду create table t3(c1 integer); insert into t2 values (2);
42) расскажите что получилось и почему